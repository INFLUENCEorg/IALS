Bootstrap: docker
From: python:3.8

%files
    Pipfile
    Pipfile.lock
    simulators

%post
    apt-get -y update
    apt-get -y install git cmake python3 g++ libxerces-c-dev libfox-1.6-dev libgdal-dev libproj-dev libgl2ps-dev python3-dev swig default-jdk maven libeigen3-dev
    git clone --recursive https://github.com/eclipse/sumo
    export SUMO_HOME="$PWD/sumo"
    mkdir sumo/build/cmake-build && cd sumo/build/cmake-build
    cmake ../..
    make -j$(nproc)
    cd /
    git clone https://github.com/INFLUENCEorg/flow.git
    pip install pipenv
    pipenv install  --deploy --system
    pip install -e ./simulators/warehouse/
    pip install -e simulators/traffic/
    chmod -R 777 /usr/local/lib/python3.8/site-packages
    
%environment    
    export SUMO_HOME="/sumo"
    export PYTHONPATH="${SUMO_HOME}/tools:${PYTHONPATH}"
    export PATH="${SUMO_HOME}/bin:${PATH}"